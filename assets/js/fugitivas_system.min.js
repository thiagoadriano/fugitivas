var Fugitivas=Fugitivas||{};Fugitivas.CONTAINER_IMAGEM="#MainContentIMG";Fugitivas.URLS={};Fugitivas.URLS.Base="/json_dados/";Fugitivas.URLS.Especialidade=Fugitivas.URLS.Base+"_especialidade.json";Fugitivas.URLS.Componente=Fugitivas.URLS.Base+"_componente.json";Fugitivas.URLS.ListaGrupo=Fugitivas.URLS.Base+"_lista_de_grupo.json";Fugitivas.URLS.Fabricante=Fugitivas.URLS.Base+"_fabricantes.json";Fugitivas.URLS.Deletar=undefined;Fugitivas.URLS.Salvar=undefined;Fugitivas.URLS.Atualizar=undefined;Fugitivas.defaultImgNotes={onAdd:function(){this.options.vAll="bottom";this.options.hAll="middle";return $(document.createElement("div")).addClass("markerPoint pointInitial").attr("data-id",Fugitivas.Methods.getLastID())},onEdit:function(n,t){var i=$(t);return Fugitivas.ModelFugitivas.flagSatatusPonto("new"),Fugitivas.ModelFugitivas.idPonto(Fugitivas.Methods.getLastID()),Fugitivas.Methods.dialogOpen("Adicionar Ponto",t)}};Fugitivas.Notifica=function(n,t){var i=n?"notifica-ok":"notifica-erro",r=n?"glyphicon-ok-sign":"glyphicon-remove-sign",u='<div id="notifica" class="'+i+'" style="display:none;"><p><span class="glyphicon '+r+'"><\/span>'+t+"<\/p><\/div>";$("#notifica").length&&$("#notifica").remove();$("body").append(u);$("#notifica").fadeIn(1e3).delay(3e3).fadeOut(1e3,function(){$(this).remove()})};$(function(){$.ajaxSetup({beforeSend:function(){$("#containerLoading").length&&$("#containerLoading").html("").remove();$("#containerLoading").css("height",$("body").height());$("body").append('<div id="containerLoading" style="display:none;"><div id="loading"><img src="assets/img/preloader.gif"><p>Aguarde os dados estão sendo carregados...<\/p><\/div><\/div>');$("#containerLoading").fadeIn("slow")},complete:function(){$("#containerLoading").fadeOut("slow",function(){$(this).html("").remove()})}})});Fugitivas=Fugitivas||{};ko.components.register("form-content",{viewModel:function(n){var t=this,i=Fugitivas.ModelFugitivas.flagSatatusPonto()!=="new"?ko.utils.arrayFirst(Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO,function(n){return Fugitivas.ModelFugitivas.idPonto()==n.ID}):undefined;t.listType=n.tipos;t.listManufacturers=n.fabricantes;t.listSpecialty=n.especialidade;t.listSubtype=ko.observableArray([{NOME:"Selecione um Tipo com Subtipo",ID:""}]);t.typeSelect=ko.observable();t.subTypeSelect=ko.observable();t.manufactSelect=ko.observable();t.dimmerSelect=ko.observable();t.dimmerComboSelect=ko.observable();t.positionSelect=ko.observable();t.specialtySelect=ko.observable();t.flagDeletar=ko.observable(!1);ko.bindingHandlers.numeric={init:function(n){function r(n){var t=n.val().toString();return t.replace(/\D/,"")}$(n).on({keypress:function(){$(this).val(r($(this)))},keyup:function(){$(this).val(r($(this)))},blur:function(){$(this).val(r($(this)))}});Fugitivas.ModelFugitivas.flagSatatusPonto()!=="new"&&i!==undefined&&(t.typeSelect(i.DADOS_PONTO.TIPO_COMPONENTE),t.subTypeSelect(i.DADOS_PONTO.SUBTIPO_COMPONENTE),t.manufactSelect(i.DADOS_PONTO.FABRICANTE),t.dimmerSelect(i.DADOS_PONTO.DIMENSAO),t.dimmerComboSelect(i.DADOS_PONTO.MEDIDA_DIMENSAO),t.positionSelect(i.DADOS_PONTO.POSICAO_PONTO),t.specialtySelect(i.DADOS_PONTO.ESPECIALIDADE_PONTO))}};t.typeSelect.subscribe(function(n){var i,r;if(t.listSubtype([]),i=t.listType()[n],i!==undefined&&i.SUBTIPO().length)for(r in i.SUBTIPO())t.listSubtype.push(i.SUBTIPO()[r]);else t.listSubtype.push({NOME:"Selecione um Tipo com Subtipo",ID:""})});t.savePoint=function(n){var i,c;if(Fugitivas.Methods.validarCampos()){var l=Fugitivas.ModelFugitivas.dadosModal(),u=l.MARCACAO_PONTO,a=Fugitivas.Methods.getLastID(),f=$(Fugitivas.CONTAINER_IMAGEM).imgNotes("export"),e=f[f.length-1],r=$(".markerPoint").last(),o=Fugitivas.Methods.getItemId(t.listType(),n.typeSelect()),s=n.subTypeSelect()!==""?Fugitivas.Methods.getItemId(o.SUBTIPO(),n.subTypeSelect()):"",h=o.SIGLA()+(s?" - "+s.SIGLA():"")+" - "+Math.floor(Math.random()*1e3);r.off("click");i={ID:a,COORDS:{X:e.x,Y:e.y},DADOS_PONTO:{TIPO_COMPONENTE:n.typeSelect(),SUBTIPO_COMPONENTE:n.subTypeSelect(),FABRICANTE:n.manufactSelect(),DIMENSAO:n.dimmerSelect(),MEDIDA_DIMENSAO:n.dimmerComboSelect(),POSICAO_PONTO:n.positionSelect(),ESPECIALIDADE_PONTO:n.specialtySelect()}};Fugitivas.URLS.Salvar!==undefined?(c=JSON.stringify(i),Fugitivas.Methods.postData(Fugitivas.URLS.Salvar,c,function(){result.success&&(u.push(i),Fugitivas.Methods.callbackCadastro(h,r))})):(u.push(i),Fugitivas.Methods.callbackCadastro(h,r))}};t.close=function(){if(t.novoPonto){var n=$(".markerPoint")[$(".markerPoint").length-1];$(n).trigger("remove");$("#NoteDialog").dialog("close")}else $("#NoteDialog").dialog("close")};t.deleted=function(){t.flagDeletar(!0)};t.noDeletar=function(){t.flagDeletar(!1)};t.yesDeletar=function(){console.log(Fugitivas.ModelFugitivas.idPonto());console.log(Fugitivas.ModelFugitivas.flagSatatusPonto());console.info(Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO);console.table(i);(Fugitivas.ModelFugitivas.idPonto()!==""||Fugitivas.ModelFugitivas.idPonto()!==undefined)&&(Fugitivas.ModelFugitivas.flagSatatusPonto()!=="new"?(Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO.remove(i),$('.fixPoint[data-id="'+Fugitivas.ModelFugitivas.idPonto()+'"]').remove(),$('.namePoint[data-id="'+Fugitivas.ModelFugitivas.idPonto()+'"]').remove()):$('.pointInitial[data-id="'+Fugitivas.ModelFugitivas.idPonto()+'"]').remove(),$("#NoteDialog").dialog("close"));console.info(Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO)}},template:'<form id="fromDados" class="form-horizontal"><div role="tabpanel"><ul class="nav nav-tabs" role="tablist"><li role="presentation" class="active"><a href="#componente" aria-controls="componente" role="tab" data-toggle="tab">Componente<\/a><\/li><li role="presentation"><a href="#caracteristicas" aria-controls="caracteristicas" role="tab" data-toggle="tab">Características<\/a><\/li><\/ul><\/div><div class="tab-content"><div role="tabpanel" class="tab-pane fade in active" id="componente"><div class="form-group"><label class="col-md-4 control-label" for="tipo">* Tipo: <\/label><div class="col-md-8"><select id="tipo" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, options: listType, optionsText: \'COMPONENTE\', optionsValue: \'ID\', optionsCaption: \'Selecione\', value: typeSelect"><\/select><\/div><\/div><div class="form-group"><label class="col-md-4 control-label" for="subtipo">* Subtipo: <\/label><div class="col-md-8"><select id="subtipo" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && subTypeSelect() != \'\' && subTypeSelect() != undefined && flagDeletar() == false, options: listSubtype, optionsText: \'NOME\', optionsValue: \'ID\', value: subTypeSelect"><\/select><\/div><\/div><div class="form-group"><label class="col-md-4 control-label" for="fabricante">* Fabricante: <\/label><div class="col-md-8"><select id="fabricante" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, options: listManufacturers, optionsText: \'RAZAO_SOCIAL\', optionsValue: \'ID\', optionsCaption: \'Selecione\', value: manufactSelect"><\/select><\/div><\/div><\/div><div role="tabpanel" class="tab-pane fade" id="caracteristicas"><div class="form-group"><label class="col-md-5 control-label" for="dimensao">* Dimensão do componente: <\/label><div class="col-md-3"><input type="text" id="dimensao" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, value: dimmerSelect, numeric: dimmerSelect"><\/div><div class="col-md-4"><select id="dimensao_medida" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, value: dimmerComboSelect"><option value="0">Polegadas<\/option><option value="1">Milímetros<\/option><\/select><\/div><\/div><div class="form-group"><label class="col-md-5 control-label" for="posicao">* Posição do ponto: <\/label><div class="col-md-7"><input type="text" id="posicao" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, value: positionSelect"class="form-control input-sm"><\/div><\/div><div class="form-group"><label class="col-md-5 control-label" for="especialidade">* Especialidade do ponto: <\/label><div class="col-md-7"><select id="especialidade" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, options: listSpecialty, optionsText: \'ESPECIALIDADE\', optionsValue: \'ID\', optionsCaption: \'Selecione\', value:specialtySelect"><\/select><\/div><\/div><\/div><div class="row"><div class="col-md-3 col-md-offset-2"><button type="submit" class="btn btn-success btn-block" data-bind="visible: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\', enable: flagDeletar() == false, click: savePoint">Salvar<\/button><\/div><div class="col-md-3"><button type="button" class="btn btn-danger btn-block" data-bind="visible: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\', enable: flagDeletar() == false, click: deleted">Deletar<\/button><\/div><div class="col-md-3"><button type="button" class="btn btn-default btn-block" data-bind="enable: flagDeletar() == false, click: close">Fechar<\/button><\/div><\/div><div class="row rowDelet" data-bind="fadeVisible: flagDeletar"><div class="col-md-12"><h2>Deseja realmente deletar este ponto?<\/h2><\/div><\/div><div class="row rowDelet" data-bind="fadeVisible: flagDeletar"><div class="col-md-4 col-md-offset-2"><button type="submit" class="btn btn-danger btn-block btn-xs" data-bind="click: yesDeletar">Sim<\/button><\/div><div class="col-md-4"><button type="button" class="btn btn-primary btn-block btn-xs" data-bind="click: noDeletar">Não<\/button><\/div><\/div><\/div><\/form>'});Fugitivas=Fugitivas||{};Fugitivas.Methods={validarCampos:function(){var i=["tipo","subtipo","fabricante","dimensao","dimensao_medida","posicao","especialidade"],u=["dimensao","dimensao_medida","posicao","especialidade"],f=["tipo","subtipo","fabricante"],n=[],r,t,e,o,s,h;for(r in i)t=$("#"+i[r]),t.attr("disabled")||(t.val()===""?(t.addClass("validation"),n.push(i[r])):t.hasClass("validation")?t.removeClass("validation"):undefined);if(n.length)for(e in u){if(n[0]===u[e]){o=$('.nav-tabs a[aria-controls="caracteristicas"]').parent().hasClass("active");o||$('.nav-tabs a[aria-controls="caracteristicas"]').trigger("click");$("#"+n[0]).focus();return}for(s in f)if(n[0]===f[s]){h=$('.nav-tabs a[aria-controls="componente"]').parent().hasClass("active");h||$('.nav-tabs a[aria-controls="componente"]').trigger("click");$("#"+n[0]).focus();return}}return n.length?0:1},setPointCustom:function(n,t,i,r,u){var f=n.replace(/\W/g,""),e="fix-"+f,h="base-"+f,o="label-"+f,s='<div class="namePoint" data-id="'+t+'" id="'+o+'"><input type="hidden" name="idPoint" value="'+t+'"/><span>'+n+'<\/span><button class="visualizar"><span class="glyphicon glyphicon-eye-open"><\/span><\/button><button class="editar"><span class="glyphicon glyphicon-edit"><\/span><\/button><\/div>';$("#viewport").append(s);$(".namePoint").last().css({top:parseInt(r)+8+"px",left:parseInt(i)+8+"px"});u.attr("id",e).removeClass("pointInitial").addClass("fixPoint");Fugitivas.Methods.createLine({})},getItemId:function(n,t){return ko.utils.arrayFirst(n,function(n){return parseInt(t)==n.ID()})||"Not Found"},callbackCadastro:function(n,t){$("#NoteDialog").dialog("close");var i=t.css("left"),r=t.css("top"),u=t.attr("data-id");Fugitivas.Methods.setPointCustom(n,u,i,r,t)},getLastID:function(){var t=Fugitivas.ModelFugitivas.dadosModal(),n=t.MARCACAO_PONTO;return n.length?parseInt(n[n.length-1].ID)+1:0},getData:function(n,t){$.ajax({url:n,type:"GET",dataType:"json",cache:!1,sync:!0,success:function(n){t&&typeof t=="function"&&t(n)},error:function(n){console.error(n)}})},postData:function(n,t,i){$.ajax({url:n,type:"POST",dataType:"json",data:t,cache:!1,sync:!0,success:function(n){i&&typeof i=="function"&&i(n)},error:function(n){console.error(n)}})},createLine:function(){jsPlumb.ready(function(){})},delegateEdit:function(){(function(){$("#viewport").on("click",".editar",function(){var n=$(this).siblings('input[name="idPoint"]').val();Fugitivas.ModelFugitivas.flagSatatusPonto("edit");Fugitivas.ModelFugitivas.idPonto(n);Fugitivas.ModelFugitivas.flagSatatusPonto()==="edit"&&Fugitivas.Methods.dialogOpen("Editar Ponto",$(this))})})()},delegateView:function(){(function(){$("#viewport").on("click",".visualizar",function(){var n=$(this).siblings('input[name="idPoint"]').val();Fugitivas.ModelFugitivas.flagSatatusPonto("view");Fugitivas.ModelFugitivas.idPonto(n);Fugitivas.ModelFugitivas.flagSatatusPonto()==="view"&&Fugitivas.Methods.dialogOpen("Visualizar Ponto",$(this))})})()},dialogOpen:function(n,t){$("#NoteDialog").remove();$('<div id="NoteDialog"><\/div>').dialog({title:n,resizable:!1,draggable:!0,modal:!0,closeOnEscape:!1,closeText:"hide",height:"280",width:"400",position:{my:"left top",at:"right bottom",of:t},open:function(){$(this).css("overflow","hidden");$(".ui-dialog-titlebar-close").remove();$(this).attr("data-bind","component: {name: 'form-content', params:{tipos: listagemComponente, fabricantes: listagemFabricante, especialidade: listagemEspecialidade} }");ko.applyBindings(Fugitivas.ModelFugitivas,$("#NoteDialog")[0])}})}};Fugitivas=Fugitivas||{};Fugitivas.ModelFugitivas={self:this,titleModal:ko.observable(),listaGrupoPontos:ko.observableArray(),editModelFugitivas:ko.observable(),pathIMg:"imagem/",dadosModal:ko.observable(),listaPontos:ko.observableArray(),btnEditar:ko.observable("Editar"),listagemComponente:ko.observableArray(),listagemEspecialidade:ko.observableArray(),listagemFabricante:ko.observableArray(),flagSatatusPonto:ko.observable(),idPonto:ko.observable(),openModal:function(n){n.ID_GRUPO_PONTO()!=""&&Fugitivas.Methods.getData(Fugitivas.URLS.Base+n.ID_GRUPO_PONTO()+".json",function(t){var i,r;Fugitivas.ModelFugitivas.dadosModal(t);for(i in t.MARCACAO_PONTO)Fugitivas.ModelFugitivas.listaPontos.push(ko.mapping.fromJS(t.MARCACAO_PONTO[i]));Fugitivas.ModelFugitivas.titleModal(n.NOME_GRUPO_PONTOS());r=$("#modalPontos");r.modal({modal:!0});$(Fugitivas.CONTAINER_IMAGEM).imgNotes(Fugitivas.defaultImgNotes);Fugitivas.Methods.delegateEdit();Fugitivas.Methods.delegateView()})},editClick:function(){$(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","canEdit")?($(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","canEdit",!1),Fugitivas.ModelFugitivas.btnEditar("Editar")):($(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","canEdit",!0),Fugitivas.ModelFugitivas.btnEditar("Concluir"))},closeModal:function(){this.dadosModal([]);Fugitivas.ModelFugitivas.btnEditar()!=="Editar"&&($(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","canEdit",!1),Fugitivas.ModelFugitivas.btnEditar("Editar"));$("#modalPontos").modal("hide");$(".viewport").html("").remove()},zoomOut:function(){$(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","zoom",1)},init:function(){Fugitivas.Methods.getData(Fugitivas.URLS.ListaGrupo,function(n){for(var t in n)Fugitivas.ModelFugitivas.listaGrupoPontos.push(ko.mapping.fromJS(n[t]))});Fugitivas.Methods.getData(Fugitivas.URLS.Componente,function(n){for(var t in n)n[t].STATUS==="ativo"&&Fugitivas.ModelFugitivas.listagemComponente.push(ko.mapping.fromJS(n[t]))});Fugitivas.Methods.getData(Fugitivas.URLS.Fabricante,function(n){for(var t in n)n[t].STATUS==="ativo"&&Fugitivas.ModelFugitivas.listagemFabricante.push(ko.mapping.fromJS(n[t]))});Fugitivas.Methods.getData(Fugitivas.URLS.Especialidade,function(n){for(var t in n)n[t].STATUS==="ativo"&&Fugitivas.ModelFugitivas.listagemEspecialidade.push(ko.mapping.fromJS(n[t]))})}};ko.applyBindings(Fugitivas.ModelFugitivas);Fugitivas.ModelFugitivas.init();ko.bindingHandlers.fadeVisible={init:function(n,t){var i=t();$(n).toggle(ko.unwrap(i))},update:function(n,t){var i=t();ko.unwrap(i)?$(n).fadeIn():$(n).fadeOut()}};
//# sourceMappingURL=fugitivas_system.min.js.map
