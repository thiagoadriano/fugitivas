"use strict";var Fugitivas=Fugitivas||{};Fugitivas.CONTAINER_IMAGEM="#MainContentIMG";Fugitivas.conectionInstance=undefined;Fugitivas.PATH_IMAGE="imagem/";Fugitivas.URLS={};Fugitivas.URLS.Base="/json_dados/";Fugitivas.URLS.Especialidade=Fugitivas.URLS.Base+"_especialidade.json";Fugitivas.URLS.Componente=Fugitivas.URLS.Base+"_componente.json";Fugitivas.URLS.ListaGrupo=Fugitivas.URLS.Base+"_lista_de_grupo.json";Fugitivas.URLS.Fabricante=Fugitivas.URLS.Base+"_fabricantes.json";Fugitivas.URLS.Deletar=undefined;Fugitivas.URLS.Salvar=undefined;Fugitivas.URLS.Atualizar=undefined;Fugitivas.URLS.AtualizarPosicaoTag=undefined;Fugitivas.URLS.RemoverGrupo=undefined;Fugitivas.URLS.SalvarGrupo=undefined;Fugitivas.defaultImgNotes={onAdd:function(){this.options.vAll="bottom";this.options.hAll="middle";var n=$(document.createElement("div"));return n.addClass("markerPoint pointInitial"),Fugitivas.ModelFugitivas.flagSatatusPonto()!=="insert"?n.attr("data-id",Fugitivas.Methods.getLastID()):n.attr("data-id",Fugitivas.ModelFugitivas.idPonto()),n},onEdit:function(n,t){var i=$(t);return Fugitivas.ModelFugitivas.flagSatatusPonto("new"),Fugitivas.ModelFugitivas.idPonto(Fugitivas.Methods.getLastID()),Fugitivas.Methods.dialogOpen("Adicionar Ponto",t)},onUpdateMarker:function(n){var t=$(n),r=$(this.img),i=r.imgViewer("imgToView",t.data("relx"),t.data("rely")),u=r.imgViewer("option","zoom");i&&(t.css({left:i.x-t.data("xOffset"),top:i.y-t.data("yOffset"),position:"absolute"}),Fugitivas.conectionInstance!==undefined&&Fugitivas.conectionInstance.repaintEverything())}};Fugitivas.defaultJSPlumb={PaintStyle:{lineWidth:2.5,strokeStyle:"white",outlineColor:"",outlineWidth:0},ConnectionsDetachable:!1,DoNotThrowErrors:!0,Connector:["Bezier",{curviness:80}],Endpoints:[["Dot",{radius:1}],["Dot",{radius:2}]],MaxConnections:10,ReattachConnections:!0,Anchors:["Bottom","TopRight"],DragOptions:{cursor:"move",zIndex:2e3},isSource:!0,isTarget:!0,Container:"viewport"};Fugitivas.paintStyle={strokeStyle:"#FFFFFF",lineWidth:2,outlineColor:"#A8A8A8",outlineWidth:.5};Fugitivas.ElModal={tituloModal:$("#tituloModal"),EMPRESA:$("#EMPRESA"),NIVEL1:$("#NIVEL1"),NIVEL2:$("#NIVEL2"),NIVEL3:$("#NIVEL3"),UNIDADE_PROCESSO:$("#UNIDADE_PROCESSO"),LINHA_PROCESSO:$("#LINHA_PROCESSO"),TAG_EQUIPAMENTO:$("#TAG_EQUIPAMENTO"),POSICAO_GRUPO:$("#POSICAO_GRUPO"),FLUXOGRAMA:$("#FLUXOGRAMA"),SITUACAO:$("#SITUACAO"),NOTA:$("#NOTA"),IMAGEM:$(Fugitivas.CONTAINER_IMAGEM),zoomOut:$("#zoomOut"),editClick:$("#editClick"),FecharModal:$("#FecharModal"),openModal:$("#grupo"),btnAddCadastro:$("#addGrupoBtn"),btnCadastro:$("#cadGrupoBtn"),btnCancelAdd:$("#cancelCad"),upload:$("#upload_cad"),nomeGrupo:$("#nomeGrupo_cad"),empresa:$("#empresa_cad"),nivel1:$("#nivel1_cad"),nivel2:$("#nivel2_cad"),nivel3:$("#nivel3_cad"),unidadeProcesso:$("#unidadeProcesso_cad"),linhaProcesso:$("#linhaProcesso_cad"),tagEquipamento:$("#tagEquipamento_cad"),posicaoGrupo:$("#posicaoGrupo_cad"),fluxograma:$("#fluxograma_cad"),situacao:$("#situacao_cad"),nota:$("#nota_cad")};Fugitivas.Notifica=function(n,t){var i=n?"notifica-ok":"notifica-erro",r=n?"glyphicon-ok-sign":"glyphicon-remove-sign",u='<div id="notifica" class="'+i+'" style="display:none;"><p><span class="glyphicon '+r+'"><\/span>'+t+"<\/p><\/div>";$("#notifica").length&&$("#notifica").remove();$("body").append(u);$("#notifica").fadeIn(1e3).delay(3e3).fadeOut(1e3,function(){$(this).remove()})};Fugitivas=Fugitivas||{};Fugitivas.Methods={validarCampos:function(){var i=["tipo","subtipo","fabricante","dimensao","dimensao_medida","posicao","especialidade"],u=["dimensao","dimensao_medida","posicao","especialidade"],f=["tipo","subtipo","fabricante"],n=[],r,t,e,o,s,h;for(r in i)t=$("#"+i[r]),t.attr("disabled")||(t.val()===""?(t.addClass("validation"),n.push(i[r])):t.hasClass("validation")?t.removeClass("validation"):undefined);if(n.length)for(e in u){if(n[0]===u[e]){o=$('.nav-tabs a[aria-controls="caracteristicas"]').parent().hasClass("active");o||$('.nav-tabs a[aria-controls="caracteristicas"]').trigger("click");$("#"+n[0]).focus();return}for(s in f)if(n[0]===f[s]){h=$('.nav-tabs a[aria-controls="componente"]').parent().hasClass("active");h||$('.nav-tabs a[aria-controls="componente"]').trigger("click");$("#"+n[0]).focus();return}}return n.length?0:1},getItemId:function(n,t){return ko.utils.arrayFirst(n,function(n){return parseInt(t)==n.ID()})||"Not Found"},callbackCadastro:function(n,t,i){Fugitivas.ModelFugitivas.flagSatatusPonto()==="new"&&$("#NoteDialog").dialog("close");var u=t.attr("data-id"),r=n.replace(/\W/g,""),e="fix-"+r,h="base-"+r,o="label-"+r,s='<input type="hidden" name="idPoint" value="'+u+'"/><span id="nomeTag">'+n+'<\/span><button class="visualizar" data-toggle="tooltip" data-placement="top" title="Visualizar"><span class="glyphicon glyphicon-eye-open"><\/span><\/button><button class="editar" data-toggle="tooltip" data-placement="top" title="Editar"><span class="glyphicon glyphicon-edit"><\/span><\/button>',f=$(document.createElement("div"));f.addClass("namePoint").attr("data-id",u).attr("id",o).css({top:i.top,left:i.left}).append(s);$(Fugitivas.CONTAINER_IMAGEM).imgViewer("addElem",f);$(Fugitivas.CONTAINER_IMAGEM).imgViewer("update");t.attr("id",e).removeClass("pointInitial").addClass("fixPoint");$(".editar, .visualizar").tooltip()},getLastID:function(){var t=Fugitivas.ModelFugitivas.dadosModal(),n=t.MARCACAO_PONTO();return n.length?parseInt(n[n.length-1].ID())+1:0},getData:function(n,t){$.ajax({url:n,type:"GET",dataType:"json",cache:!1,sync:!0,success:function(n){t&&typeof t=="function"&&t(n)},error:function(n){console.error(n)}})},postData:function(n,t,i){$.ajax({url:n,type:"POST",dataType:"json",data:t,cache:!1,sync:!0,success:function(n){i&&typeof i=="function"&&i(n)},error:function(n){console.error(n)}})},createLine:function(){jsPlumb.ready(function(){Fugitivas.conectionInstance=jsPlumb.getInstance(Fugitivas.defaultJSPlumb);Fugitivas.conectionInstance.batch(function(){var n=Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO(),t,i;if(n.length)for(t in n)i=n[t].ID(),Fugitivas.Methods.connect(i)})})},delegateEdit:function(){(function(){$("#viewport").on("click",".editar",function(){var n=$(this).siblings('input[name="idPoint"]').val();Fugitivas.ModelFugitivas.flagSatatusPonto("edit");Fugitivas.ModelFugitivas.idPonto(n);Fugitivas.ModelFugitivas.flagSatatusPonto()==="edit"&&Fugitivas.Methods.dialogOpen("Editar Ponto",$(this))})})()},delegateView:function(){(function(){$("#viewport").on("click",".visualizar",function(){var n=$(this).siblings('input[name="idPoint"]').val();Fugitivas.ModelFugitivas.flagSatatusPonto("view");Fugitivas.ModelFugitivas.idPonto(n);Fugitivas.ModelFugitivas.flagSatatusPonto()==="view"&&Fugitivas.Methods.dialogOpen("Visualizar Ponto",$(this))})})()},dialogOpen:function(n,t){$("#NoteDialog").remove();$('<div id="NoteDialog"><\/div>').dialog({title:n,resizable:!1,draggable:!0,modal:!0,closeOnEscape:!1,closeText:"hide",height:"280",width:"400",position:{my:"left top",at:"right bottom",of:t},open:function(){$(this).css("overflow","hidden");$(".ui-dialog-titlebar-close").remove();$(this).attr("data-bind","component: {name: 'form-content', params:{tipos: listagemComponente, fabricantes: listagemFabricante, especialidade: listagemEspecialidade} }");ko.applyBindings(Fugitivas.ModelFugitivas,$("#NoteDialog")[0])}})},buscaComponetes:function(n,t){var i=Fugitivas.ModelFugitivas.listagemComponente(),f="",e="",r,u;for(r in i)if(i[r].ID()===n.toString()){f=i[r];for(u in i[r].SUBTIPO())if(i[r].SUBTIPO().length>0&&i[r].SUBTIPO()[u].ID()===t.toString()){e=i[r].SUBTIPO()[u].SIGLA_SUBTIPO();break}else if(i[r].SUBTIPO().length===0)break}else if(i.length===0)break;return{tipo:f,subtipo:e}},carregaPontos:function(){var t=Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO(),f=t.length,n,i,r,u;if(t.length){for(Fugitivas.ModelFugitivas.flagSatatusPonto("insert"),n=0;n<f;n++)i=Fugitivas.Methods.buscaComponetes(t[n].DADOS_PONTO.TIPO_COMPONENTE(),t[n].DADOS_PONTO.SUBTIPO_COMPONENTE()),Fugitivas.ModelFugitivas.idPonto(t[n].ID()),$(Fugitivas.CONTAINER_IMAGEM).imgNotes("addNote",t[n].COORDS.X(),t[n].COORDS.Y(),null),r=$(".markerPoint").last(),r.off("click"),u=i.tipo.SIGLA()+(i.subtipo!==""?" - "+i.subtipo:"")+" - "+t[n].HASH(),Fugitivas.Methods.callbackCadastro(u,r,{top:t[n].POSICAO_TAG.TOP(),left:t[n].POSICAO_TAG.LEFT()});Fugitivas.ModelFugitivas.flagSatatusPonto("new")}},dispararEventos:function(){$("#modalPontos").modal("show");$(Fugitivas.CONTAINER_IMAGEM).imgNotes(Fugitivas.defaultImgNotes);$("#viewport > img").hide().on("load",function(){setTimeout(function(){$(Fugitivas.CONTAINER_IMAGEM).imgViewer("update");$("#viewport > img").show();Fugitivas.Methods.delegateEdit();Fugitivas.Methods.delegateView();Fugitivas.Methods.carregaPontos();Fugitivas.Methods.createLine()},600)})},preencheModal:function(n){Fugitivas.ElModal.EMPRESA.val(n.EMPRESA());Fugitivas.ElModal.NIVEL1.val(n.NIVEL1());Fugitivas.ElModal.NIVEL2.val(n.NIVEL2());Fugitivas.ElModal.NIVEL3.val(n.NIVEL3());Fugitivas.ElModal.UNIDADE_PROCESSO.val(n.UNIDADE_PROCESSO());Fugitivas.ElModal.LINHA_PROCESSO.val(n.LINHA_PROCESSO());Fugitivas.ElModal.TAG_EQUIPAMENTO.val(n.TAG_EQUIPAMENTO());Fugitivas.ElModal.POSICAO_GRUPO.val(n.POSICAO_GRUPO());Fugitivas.ElModal.FLUXOGRAMA.val(n.FLUXOGRAMA());Fugitivas.ElModal.NOTA.val(n.NOTA());Fugitivas.ElModal.SITUACAO.val(n.SITUACAO());Fugitivas.ElModal.IMAGEM.attr("src",Fugitivas.PATH_IMAGE+n.IMG_NAME())},connect:function(n){var i=$('.fixPoint[data-id="'+n+'"]'),t=$('.namePoint[data-id="'+n+'"]');Fugitivas.conectionInstance.connect({source:i,target:t,scope:"link_"+n,anchor:"AutoDefault",paintStyle:Fugitivas.paintStyle});Fugitivas.conectionInstance.draggable(t);t.on("dragstop",function(){function r(){setTimeout(function(){var i={left:parseInt(n.leftPosition),top:parseInt(n.topPosition)};Fugitivas.conectionInstance.repaint(t,i)},40)}var t=$(this),e=$("#viewport"),s=t.text().length<10?11:t.text().length,h=t.find(".editar").is(":visible")?45:20,n={id:t.attr("data-id"),topPosition:t.css("top"),leftPosition:t.css("left")},o={height:parseInt(t.css("height"))+2,width:s*7+h},i={width:parseInt(e.width()),height:parseInt(e.height())},u,f;parseInt(n.leftPosition)<0&&($(this).css("left","0px"),n.leftPosition="0px",r());parseInt(n.leftPosition)>i.width&&(u=i.width-o.width+"px",$(this).css("left",u),n.leftPosition=u,r());parseInt(n.topPosition)<0&&($(this).css("top","0px"),n.topPosition="0px",r());parseInt(n.topPosition)>i.height&&(f=i.height-o.height+"px",$(this).css("top",f),n.topPosition=f,r());Fugitivas.Methods.salvarPosicaoTag(n)})},salvarPosicaoTag:function(n){var t=ko.utils.arrayFirst(Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO(),function(t){return n.id==t.ID()});Fugitivas.URLS.AtualizarPosicaoTag?Fugitivas.Methods.postData(Fugitivas.URLS.AtualizarPosicaoTag+Fugitivas.ModelFugitivas.dadosModal().ID,n,function(i){"use strict";i.type&&(t.POSICAO_TAG.TOP(n.topPosition),t.POSICAO_TAG.LEFT(n.leftPosition));Fugitivas.Notifica(i.type,i.mensagem)}):(t.POSICAO_TAG.TOP(n.topPosition),t.POSICAO_TAG.LEFT(n.leftPosition),Fugitivas.Notifica(!0,"Posição atualizada com sucesso!"))},bloquearInputCadastro:function(n){$.fn.bloqueio=function(n){n?$(this).attr({disabled:"disabled",readonly:"readonly"}):$(this).removeAttr("disabled").removeAttr("readonly")};n?$("#upload_row").hide():$("#upload_row").show();Fugitivas.ElModal.nomeGrupo.bloqueio(n);Fugitivas.ElModal.empresa.bloqueio(n);Fugitivas.ElModal.nivel1.bloqueio(n);Fugitivas.ElModal.nivel2.bloqueio(n);Fugitivas.ElModal.nivel3.bloqueio(n);Fugitivas.ElModal.unidadeProcesso.bloqueio(n);Fugitivas.ElModal.linhaProcesso.bloqueio(n);Fugitivas.ElModal.tagEquipamento.bloqueio(n);Fugitivas.ElModal.posicaoGrupo.bloqueio(n);Fugitivas.ElModal.situacao.bloqueio(n);Fugitivas.ElModal.fluxograma.bloqueio(n);Fugitivas.ElModal.nota.bloqueio(n)},limparModalCadastro:function(){Fugitivas.ElModal.nomeGrupo.val("");Fugitivas.ElModal.empresa.val("");Fugitivas.ElModal.nivel1.val("");Fugitivas.ElModal.nivel2.val("");Fugitivas.ElModal.nivel3.val("");Fugitivas.ElModal.unidadeProcesso.val("");Fugitivas.ElModal.linhaProcesso.val("");Fugitivas.ElModal.tagEquipamento.val("");Fugitivas.ElModal.posicaoGrupo.val("");Fugitivas.ElModal.fluxograma.val("");Fugitivas.ElModal.situacao.val("");Fugitivas.ElModal.upload.val("");Fugitivas.ElModal.nota.val("")},isValideFormCadastro:function(n){var u,r,i,t;try{if(Array.isArray(n)){for(u=n.length,r=[],i=0;i<u;i++)t=$(n[i]),t.length&&(t.val()===""?(t.addClass("validation"),r.push(n[i])):t.hasClass("validation")?t.removeClass("validation"):null);return r.length?!1:!0}throw"Não é um array de String";}catch(f){console.error(f)}},preencheGrupoModal:function(n,t){(t!=="view"||t!=="edit")&&(t==="view"?(Fugitivas.ElModal.btnCadastro.hide(),Fugitivas.ElModal.btnCancelAdd.text("Fechar"),Fugitivas.Methods.bloquearInputCadastro(!0)):t==="edit"&&(Fugitivas.ElModal.btnCadastro.show(),Fugitivas.ElModal.btnCancelAdd.text("Cancelar"),Fugitivas.Methods.bloquearInputCadastro(!1)),Fugitivas.Methods.getData(Fugitivas.URLS.Base+n.ID_GRUPO_PONTO()+".json",function(t){"use strict";Fugitivas.ElModal.nomeGrupo.val(n.NOME_GRUPO_PONTOS());Fugitivas.ElModal.empresa.val(t.EMPRESA);Fugitivas.ElModal.nivel1.val(t.NIVEL1);Fugitivas.ElModal.nivel2.val(t.NIVEL2);Fugitivas.ElModal.nivel3.val(t.NIVEL3);Fugitivas.ElModal.unidadeProcesso.val(t.UNIDADE_PROCESSO);Fugitivas.ElModal.linhaProcesso.val(t.LINHA_PROCESSO);Fugitivas.ElModal.tagEquipamento.val(t.TAG_EQUIPAMENTO);Fugitivas.ElModal.posicaoGrupo.val(t.POSICAO_GRUPO);Fugitivas.ElModal.fluxograma.val(t.FLUXOGRAMA);Fugitivas.ElModal.situacao.val(t.SITUACAO);Fugitivas.ElModal.nota.val(t.NOTA);$("#modalIncludGroup").modal("show")}))}};Fugitivas=Fugitivas||{};Fugitivas.ModelFugitivas={listaGrupoPontos:ko.observableArray(),dadosModal:ko.observable(),listaPontos:ko.observableArray(),listagemComponente:ko.observableArray(),listagemEspecialidade:ko.observableArray(),listagemFabricante:ko.observableArray(),flagSatatusPonto:ko.observable(),idPonto:ko.observable(),nomeExclude:ko.observable(),idExclude:ko.observable(),idEditGroup:ko.observable(),idViewGroup:ko.observable(),callAfter:function(){$('.btn[data-toggle="tooltip"]').tooltip()},editGroup:function(n){Fugitivas.ModelFugitivas.idEditGroup(n.ID());Fugitivas.Methods.preencheGrupoModal(n,"edit")},viewGroup:function(n){Fugitivas.ModelFugitivas.idViewGroup(n.ID());Fugitivas.Methods.preencheGrupoModal(n,"view")},deleteGroup:function(){var n=Fugitivas.ModelFugitivas.idExclude(),t;Fugitivas.URLS.RemoverGrupo?Fugitivas.Methods.postData(Fugitivas.URLS.RemoverGrupo,{id:n},function(t){"use strict";if(t.type){var i=Fugitivas.Methods.getItemId(Fugitivas.ModelFugitivas.listaGrupoPontos(),n);Fugitivas.ModelFugitivas.listaGrupoPontos.remove(i);Fugitivas.ModelFugitivas.closeModalExclude()}Fugitivas.Notifica(t.type,t.mensagem)}):(t=Fugitivas.Methods.getItemId(Fugitivas.ModelFugitivas.listaGrupoPontos(),n),Fugitivas.ModelFugitivas.listaGrupoPontos.remove(t),Fugitivas.ModelFugitivas.closeModalExclude(),Fugitivas.Notifica(!0,"Grupo Removido com sucesso!"))},deleteGroupConfirm:function(n){Fugitivas.ModelFugitivas.nomeExclude(n.NOME_GRUPO_PONTOS());Fugitivas.ModelFugitivas.idExclude(n.ID());$("#confirmDelete").modal("show")},closeModalExclude:function(){$("#confirmDelete").modal("hide");Fugitivas.ModelFugitivas.nomeExclude("");Fugitivas.ModelFugitivas.idExclude("")},initcial:function(){Fugitivas.Methods.getData(Fugitivas.URLS.ListaGrupo,function(n){for(var t in n)Fugitivas.ModelFugitivas.listaGrupoPontos.push(ko.mapping.fromJS(n[t]))});Fugitivas.Methods.getData(Fugitivas.URLS.Componente,function(n){for(var t in n)n[t].STATUS==="ativo"&&Fugitivas.ModelFugitivas.listagemComponente.push(ko.mapping.fromJS(n[t]))});Fugitivas.Methods.getData(Fugitivas.URLS.Fabricante,function(n){for(var t in n)n[t].STATUS==="ativo"&&Fugitivas.ModelFugitivas.listagemFabricante.push(ko.mapping.fromJS(n[t]))});Fugitivas.Methods.getData(Fugitivas.URLS.Especialidade,function(n){for(var t in n)n[t].STATUS==="ativo"&&Fugitivas.ModelFugitivas.listagemEspecialidade.push(ko.mapping.fromJS(n[t]))})}};ko.applyBindings(Fugitivas.ModelFugitivas);Fugitivas.ModelFugitivas.initcial();ko.bindingHandlers.fadeVisible={init:function(n,t){var i=t();$(n).toggle(ko.unwrap(i))},update:function(n,t){var i=t();ko.unwrap(i)?$(n).fadeIn():$(n).fadeOut()}};Fugitivas=Fugitivas||{};ko.components.register("form-content",{viewModel:function(n){var t=this,i=Fugitivas.ModelFugitivas.flagSatatusPonto()!=="new"?ko.utils.arrayFirst(Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO(),function(n){return Fugitivas.ModelFugitivas.idPonto()==n.ID()}):undefined;t.listType=n.tipos;t.listManufacturers=n.fabricantes;t.listSpecialty=n.especialidade;t.listSubtype=ko.observableArray([{NOME:"Selecione um Tipo com Subtipo",ID:""}]);t.typeSelect=ko.observable();t.subTypeSelect=ko.observable();t.manufactSelect=ko.observable();t.dimmerSelect=ko.observable();t.dimmerComboSelect=ko.observable();t.positionSelect=ko.observable();t.specialtySelect=ko.observable();t.flagDeletar=ko.observable(!1);t.save={novo:function(n){var c=Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO(),o=Fugitivas.Methods.getLastID(),l=$(Fugitivas.CONTAINER_IMAGEM).imgNotes("export"),u=l[l.length-1],s=$(".markerPoint").last(),h=Fugitivas.Methods.getItemId(t.listType(),n.typeSelect()),f=n.subTypeSelect()!==""?Fugitivas.Methods.getItemId(h.SUBTIPO(),n.subTypeSelect()):"",i=$(Fugitivas.CONTAINER_IMAGEM).imgViewer("imgToView",u.x,u.y),r,e,a;s.off("click");r={ID:o,COORDS:{X:u.x,Y:u.y},POSICAO_TAG:{TOP:i.y,LEFT:i.x},DADOS_PONTO:{TIPO_COMPONENTE:n.typeSelect(),SUBTIPO_COMPONENTE:n.subTypeSelect(),FABRICANTE:n.manufactSelect(),DIMENSAO:n.dimmerSelect(),MEDIDA_DIMENSAO:n.dimmerComboSelect(),POSICAO_PONTO:n.positionSelect(),ESPECIALIDADE_PONTO:n.specialtySelect()}};Fugitivas.URLS.Salvar?Fugitivas.Methods.postData(Fugitivas.URLS.Salvar+Fugitivas.ModelFugitivas.dadosModal().ID(),JSON.stringify(r),function(n){"use strict";if(n.type){var t=h.SIGLA()+(f?" - "+f.SIGLA_SUBTIPO():"")+" - "+n.HASH;r.HASH=e;c.push(ko.mapping.fromJS(r));Fugitivas.Methods.callbackCadastro(t,s,{top:i.y,left:i.x});Fugitivas.Methods.connect(o);$(".editar").show()}Fugitivas.Notifica(n.type,n.mensagem)}):(e=Math.floor(Math.random()*1e3),a=h.SIGLA()+(f?" - "+f.SIGLA_SUBTIPO():"")+" - "+e,r.HASH=e,c.push(ko.mapping.fromJS(r)),Fugitivas.Methods.callbackCadastro(a,s,{top:i.y,left:i.x}),Fugitivas.Methods.connect(o),$(".editar").show(),Fugitivas.Notifica(!0,"Ponto Cadastrado com Sucesso!"))},atualiza:function(n){var o=Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO(),r=Fugitivas.Methods.getItemId(t.listType(),n.typeSelect()),u=n.subTypeSelect()!==""?Fugitivas.Methods.getItemId(r.SUBTIPO(),n.subTypeSelect()):"",i=ko.utils.arrayFirst(Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO(),function(n){return Fugitivas.ModelFugitivas.idPonto()==n.ID()}),f=r.SIGLA()+(u?" - "+u.SIGLA_SUBTIPO():"")+" - "+i.HASH(),e={ID_GRUPO:Fugitivas.ModelFugitivas.dadosModal().ID(),ID:Fugitivas.ModelFugitivas.idPonto(),DADOS_PONTO:{TIPO_COMPONENTE:n.typeSelect(),SUBTIPO_COMPONENTE:n.subTypeSelect(),FABRICANTE:n.manufactSelect(),DIMENSAO:n.dimmerSelect(),MEDIDA_DIMENSAO:n.dimmerComboSelect(),POSICAO_PONTO:n.positionSelect(),ESPECIALIDADE_PONTO:n.specialtySelect()}};Fugitivas.URLS.Atualizar?Fugitivas.Methods.postData(Fugitivas.URLS.Atualizar+Fugitivas.ModelFugitivas.dadosModal().ID(),JSON.stringify(e),function(t){"use strict";t.type&&(i.DADOS_PONTO.TIPO_COMPONENTE(n.typeSelect()),i.DADOS_PONTO.SUBTIPO_COMPONENTE(n.subTypeSelect()),i.DADOS_PONTO.FABRICANTE(n.manufactSelect()),i.DADOS_PONTO.DIMENSAO(n.dimmerSelect()),i.DADOS_PONTO.MEDIDA_DIMENSAO(n.dimmerComboSelect()),i.DADOS_PONTO.POSICAO_PONTO(n.positionSelect()),i.DADOS_PONTO.ESPECIALIDADE_PONTO(n.specialtySelect()),$(".namePoint[data-id='"+Fugitivas.ModelFugitivas.idPonto()+"']").find("#nomeTag").text(f),$("#NoteDialog").dialog("close"));Fugitivas.Notifica(t.type,t.mensagem)}):(i.DADOS_PONTO.TIPO_COMPONENTE(n.typeSelect()),i.DADOS_PONTO.SUBTIPO_COMPONENTE(n.subTypeSelect()),i.DADOS_PONTO.FABRICANTE(n.manufactSelect()),i.DADOS_PONTO.DIMENSAO(n.dimmerSelect()),i.DADOS_PONTO.MEDIDA_DIMENSAO(n.dimmerComboSelect()),i.DADOS_PONTO.POSICAO_PONTO(n.positionSelect()),i.DADOS_PONTO.ESPECIALIDADE_PONTO(n.specialtySelect()),$(".namePoint[data-id='"+Fugitivas.ModelFugitivas.idPonto()+"']").find("#nomeTag").text(f),$("#NoteDialog").dialog("close"),Fugitivas.Notifica(!0,"Ponto atualizado com Sucesso!"))}};ko.bindingHandlers.numeric={init:function(n){function t(n){var t=n.val().toString();return t.replace(/\D/,"")}$(n).on({keypress:function(){$(this).val(t($(this)))},keyup:function(){$(this).val(t($(this)))},blur:function(){$(this).val(t($(this)))}})}};ko.bindingHandlers.dadosInicial={init:function(){Fugitivas.ModelFugitivas.flagSatatusPonto()!=="new"&&i!==undefined&&(t.typeSelect(i.DADOS_PONTO.TIPO_COMPONENTE()),t.subTypeSelect(i.DADOS_PONTO.SUBTIPO_COMPONENTE()),t.manufactSelect(i.DADOS_PONTO.FABRICANTE()),t.dimmerSelect(i.DADOS_PONTO.DIMENSAO()),t.dimmerComboSelect(i.DADOS_PONTO.MEDIDA_DIMENSAO()),t.positionSelect(i.DADOS_PONTO.POSICAO_PONTO()),t.specialtySelect(i.DADOS_PONTO.ESPECIALIDADE_PONTO()))}};t.typeSelect.subscribe(function(n){var i,r;if(t.listSubtype([]),i=t.listType()[n],i!==undefined&&i.SUBTIPO().length)for(r in i.SUBTIPO())t.listSubtype.push(i.SUBTIPO()[r]);else t.listSubtype.push({NOME:"Selecione um Tipo com Subtipo",ID:""})});t.savePoint=function(n){Fugitivas.Methods.validarCampos()&&(Fugitivas.ModelFugitivas.flagSatatusPonto()==="new"?t.save.novo(n):Fugitivas.ModelFugitivas.flagSatatusPonto()==="edit"&&t.save.atualiza(n))};t.close=function(){if(t.novoPonto){var n=$(".markerPoint")[$(".markerPoint").length-1];$(n).trigger("remove");$("#NoteDialog").dialog("close")}else $("#NoteDialog").dialog("close")};t.deleted=function(){t.flagDeletar(!0)};t.noDeletar=function(){t.flagDeletar(!1)};t.yesDeletar=function(){var t,r,n;Fugitivas.ModelFugitivas.idPonto()!==""&&Fugitivas.ModelFugitivas.idPonto()!==undefined&&(Fugitivas.ModelFugitivas.flagSatatusPonto()!=="new"?Fugitivas.URLS.Deletar?Fugitivas.Methods.postData(Fugitivas.URLS.Deletar+Fugitivas.ModelFugitivas.idPonto(),i,function(n){"use strict";if(n.type){Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO.remove(i);var t=document.querySelector('.fixPoint[data-id="'+Fugitivas.ModelFugitivas.idPonto()+'"]'),r=document.querySelector('.namePoint[data-id="'+Fugitivas.ModelFugitivas.idPonto()+'"]');t.parentNode&&(Fugitivas.conectionInstance.remove(t),r.parentNode.removeChild(r))}Fugitivas.Notifica(n.type,n.mensagem)}):(Fugitivas.ModelFugitivas.dadosModal().MARCACAO_PONTO.remove(i),t=document.querySelector('.fixPoint[data-id="'+Fugitivas.ModelFugitivas.idPonto()+'"]'),r=document.querySelector('.namePoint[data-id="'+Fugitivas.ModelFugitivas.idPonto()+'"]'),t.parentNode&&(Fugitivas.conectionInstance.remove(t),r.parentNode.removeChild(r)),Fugitivas.Notifica(!0,"Ponto Deletado com Sucesso!")):(n=document.querySelector('.pointInitial[data-id="'+Fugitivas.ModelFugitivas.idPonto()+'"]'),n.parentNode&&n.parentNode.removeChild(n)),$("#NoteDialog").dialog("close"))}},template:'<form id="fromDados" class="form-horizontal" data-bind="dadosInicial"><div role="tabpanel"><ul class="nav nav-tabs" role="tablist"><li role="presentation" class="active"><a href="#componente" aria-controls="componente" role="tab" data-toggle="tab">Componente<\/a><\/li><li role="presentation"><a href="#caracteristicas" aria-controls="caracteristicas" role="tab" data-toggle="tab">Características<\/a><\/li><\/ul><\/div><div class="tab-content"><div role="tabpanel" class="tab-pane fade in active" id="componente"><div class="form-group"><label class="col-md-4 control-label" for="tipo">* Tipo: <\/label><div class="col-md-8"><select id="tipo" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, options: listType, optionsText: \'COMPONENTE\', optionsValue: \'ID\', optionsCaption: \'Selecione\', value: typeSelect"><\/select><\/div><\/div><div class="form-group"><label class="col-md-4 control-label" for="subtipo">* Subtipo: <\/label><div class="col-md-8"><select id="subtipo" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && subTypeSelect() != \'\' && subTypeSelect() != undefined && flagDeletar() == false, options: listSubtype, optionsText: \'NOME\', optionsValue: \'ID\', value: subTypeSelect"><\/select><\/div><\/div><div class="form-group"><label class="col-md-4 control-label" for="fabricante">* Fabricante: <\/label><div class="col-md-8"><select id="fabricante" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, options: listManufacturers, optionsText: \'RAZAO_SOCIAL\', optionsValue: \'ID\', optionsCaption: \'Selecione\', value: manufactSelect"><\/select><\/div><\/div><\/div><div role="tabpanel" class="tab-pane fade" id="caracteristicas"><div class="form-group"><label class="col-md-5 control-label" for="dimensao">* Dimensão do componente: <\/label><div class="col-md-3"><input type="text" id="dimensao" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, value: dimmerSelect, numeric: dimmerSelect"><\/div><div class="col-md-4"><select id="dimensao_medida" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, value: dimmerComboSelect"><option value="0">Polegadas<\/option><option value="1">Milímetros<\/option><\/select><\/div><\/div><div class="form-group"><label class="col-md-5 control-label" for="posicao">* Posição do ponto: <\/label><div class="col-md-7"><input type="text" id="posicao" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, value: positionSelect"class="form-control input-sm"><\/div><\/div><div class="form-group"><label class="col-md-5 control-label" for="especialidade">* Especialidade do ponto: <\/label><div class="col-md-7"><select id="especialidade" class="form-control input-sm" data-bind="enable: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\' && flagDeletar() == false, options: listSpecialty, optionsText: \'ESPECIALIDADE\', optionsValue: \'ID\', optionsCaption: \'Selecione\', value:specialtySelect"><\/select><\/div><\/div><\/div><div class="row"><div class="col-md-3 col-md-offset-2"><button type="submit" class="btn btn-success btn-block" data-bind="visible: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\', enable: flagDeletar() == false, click: savePoint">Salvar<\/button><\/div><div class="col-md-3"><button type="button" class="btn btn-danger btn-block" data-bind="visible: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'view\', enable: flagDeletar() == false, click: deleted">Deletar<\/button><\/div><div class="col-md-3"><button type="button" class="btn btn-default btn-block" data-bind="visible: Fugitivas.ModelFugitivas.flagSatatusPonto() != \'new\', enable: flagDeletar() == false, click: close">Fechar<\/button><\/div><\/div><div class="row rowDelet" data-bind="fadeVisible: flagDeletar"><div class="col-md-12"><h2>Deseja realmente deletar este ponto?<\/h2><\/div><\/div><div class="row rowDelet" data-bind="fadeVisible: flagDeletar"><div class="col-md-4 col-md-offset-2"><button type="submit" class="btn btn-danger btn-block btn-xs" data-bind="click: yesDeletar">Sim<\/button><\/div><div class="col-md-4"><button type="button" class="btn btn-primary btn-block btn-xs" data-bind="click: noDeletar">Não<\/button><\/div><\/div><\/div><\/form>'});$(function(){$("#containerLoading").css("height",$(window).height());$.ajaxSetup({beforeSend:function(){$("#containerLoading").fadeIn("slow")},complete:function(){$("#containerLoading").fadeOut("slow")}});Fugitivas.ElModal.FecharModal.on("click",function(){$("#modalPontos").modal("hide");$(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","canEdit")&&$(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","canEdit",!1);Fugitivas.ElModal.IMAGEM.attr("src","");$(Fugitivas.CONTAINER_IMAGEM).imgNotes("destroy");Fugitivas.ElModal.editClick.text("Editar");conectionInstance=null});Fugitivas.ElModal.openModal.on("click",".openModal",function(){var n=$(this).attr("data-id-grupo"),t=$(this).parents("tr").find(".nomeGrupo").text();n!=""&&Fugitivas.Methods.getData(Fugitivas.URLS.Base+n+".json",function(n){Fugitivas.ModelFugitivas.dadosModal(ko.mapping.fromJS(n));Fugitivas.ElModal.tituloModal.text(t);Fugitivas.Methods.preencheModal(Fugitivas.ModelFugitivas.dadosModal());Fugitivas.Methods.dispararEventos()})});Fugitivas.ElModal.editClick.on("click",function(){$(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","canEdit")?($(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","canEdit",!1),$(this).text("Editar"),$(".editar").hide()):($(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","canEdit",!0),$(this).text("Concluir"),$(".editar").show())});Fugitivas.ElModal.zoomOut.on("click",function(){$(Fugitivas.CONTAINER_IMAGEM).imgNotes("option","zoom",1);Fugitivas.conectionInstance.repaintEverything()});Fugitivas.ElModal.btnAddCadastro.on("click",function(){Fugitivas.Methods.bloquearInputCadastro(!1);$("#modalIncludGroup").modal("show")});Fugitivas.ElModal.btnCancelAdd.on("click",function(){Fugitivas.ModelFugitivas.idEditGroup("");Fugitivas.ModelFugitivas.idViewGroup("");$("#modalIncludGroup").modal("hide");Fugitivas.Methods.limparModalCadastro()});Fugitivas.ElModal.btnCadastro.on("click",function(){var r;if(Fugitivas.Methods.isValideFormCadastro(["#nomeGrupo_cad","#empresa_cad","#nivel1_cad","#nivel2_cad","#nivel3_cad","#unidadeProcesso_cad","#linhaProcesso_cad","#tagEquipamento_cad","#posicaoGrupo_cad","#fluxograma_cad","#situacao_cad","#nota_cad"])){var t=Fugitivas.ModelFugitivas.listaGrupoPontos(),u=parseInt(t[t.length-1].ID_GRUPO_PONTO())+1,f=parseInt(t[t.length-1].ID())+1,n={NomeGrupo:Fugitivas.ElModal.nomeGrupo.val(),Empresa:Fugitivas.ElModal.empresa.val(),Nivel1:Fugitivas.ElModal.nivel1.val(),Nivel2:Fugitivas.ElModal.nivel2.val(),Nivel3:Fugitivas.ElModal.nivel3.val(),UnidadeProcesso:Fugitivas.ElModal.unidadeProcesso.val(),LinhaProcesso:Fugitivas.ElModal.linhaProcesso.val(),TagEquipamento:Fugitivas.ElModal.tagEquipamento.val(),PosicaoGrupo:Fugitivas.ElModal.posicaoGrupo.val(),Fluxograma:Fugitivas.ElModal.fluxograma.val(),Situacao:Fugitivas.ElModal.situacao.val(),upload:Fugitivas.ElModal.upload.val(),Nota:Fugitivas.ElModal.nota.val()},i={ID:f,NOME_GRUPO_PONTOS:n.NomeGrupo,UNIDADE_PROCESSO:n.UnidadeProcesso,LINHA_PROCESSO:n.LinhaProcesso,TAG_EQUIPAMENTO:n.TagEquipamento,EXISTE_IMAGEM:n.upload.length?!0:!1,ID_GRUPO_PONTO:u};Fugitivas.URLS.SalvarGrupo?(r={url:Fugitivas.URLS.SalvarGrupo,success:function(n){n.type&&(Fugitivas.ModelFugitivas.listaGrupoPontos.push(ko.mapping.fromJS(i)),Fugitivas.ElModal.btnCancelAdd.trigger("click"),Fugitivas.Methods.limparModalCadastro());Fugitivas.Notifica(n.type,n.mensagem)}},$("#formCadastro").ajaxForm(r)):(Fugitivas.ModelFugitivas.listaGrupoPontos.push(ko.mapping.fromJS(i)),Fugitivas.Notifica(!0,"Grupo Cadastrado com Sucesso!"),Fugitivas.ElModal.btnCancelAdd.trigger("click"),Fugitivas.Methods.limparModalCadastro())}});Fugitivas.ElModal.upload.filestyle()});
//# sourceMappingURL=fugitivas.min.js.map
